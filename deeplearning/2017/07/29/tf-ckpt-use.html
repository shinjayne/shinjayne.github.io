
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Google Analytics js-->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-101872700-1', 'auto');
    ga('send', 'pageview');
  </script>

  <!-- code highlight js / css-->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- BootStrap js / css-->
    <link href="/bootstrap-3.3.2/css/bootstrap.css" rel="stylesheet">
    <!-- jQuery (부트스트랩의 자바스크립트 플러그인을 위해 필요합니다) -->
     <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
     <!-- 모든 컴파일된 플러그인을 포함합니다 (아래), 원하지 않는다면 필요한 각각의 파일을 포함하세요 -->
     <script src="/bootstrap-3.3.2/js/bootstrap.js"></script>

    <!-- JUPYTER NOTEBOOK js / css-->

     <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

     <link href="/jupyterstyle/jupyterstyle.css" rel="stylesheet">


  <!-- Semantic UI js / css-->
    <link rel="stylesheet" type="text/css" href="/semantic/semantic.css">
    <script
      src="https://code.jquery.com/jquery-3.1.1.min.js"
      integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
      crossorigin="anonymous"></script>
    <script src="/semantic/semantic.js"></script>




    <title>tensorflow 로 checkpoint 파일(.ckpt)과 ckeckpoint state proto 이용하기 : Variable 저장과 재활용</title>

  </head>
  <body>

    <div class = "ui container">
<!---
      <div class="ui visible left vertical inverted sidebar labeled icon menu">
        <div class="item">
          shinjayne
        </div>
        <h5> <a class="item" href = "https://shinjayne.github.io/">Home</a> </h5>
        <h5> <a class="item" href = "https://shinjayne.github.io//category">Categories</a> </h5>
        <h5> <a class="item" href = "https://shinjayne.github.io//about">About</a> </h5>
      </div>
-->
      <div class="ui stackable grid">
        <div class="one wide column">

        </div>

        <div class="fourteen wide column">

            <div class="ui center aligned inverted segment" >

              <h1  class="ui inverted header" ></h1>
              <h1  class="ui inverted header" >shinjayne</h1>
              <h1  class="ui inverted header" ></h1>

              <div class="right item">
                <a class="ui inverted button" href = "https://shinjayne.github.io/">Home</a>
                <a class="ui inverted button" href = "https://shinjayne.github.io//category">Categories</a>
                <a class="ui inverted button" href = "https://shinjayne.github.io//projects">Projects</a>
              </div>
            </div>
        </div>

        <div class="one wide column">

        </div>

        <div class="one wide column">

</div>

<div class="fourteen wide column">
  <div class = "ui segment">
    <h1>tensorflow 로 checkpoint 파일(.ckpt)과 ckeckpoint state proto 이용하기 : Variable 저장과 재활용</h1>

    <li>
      작성일 : 29 July 2017
    </li>
    <li>
      카테고리 : <a href = "https://shinjayne.github.io//category">DeepLearning</a>
    </li>
  </div>

  <div class = "ui segment">
    
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>tensorflow 로 학습시킨 딥러닝 모델을 저장하는 방법중 하나로 <code>Checkpoint</code> 을 이용하는 방법이 있다.</p>
<p><code>Checkpoint</code> 은 학습된 모델의 Variable 값을 저장하는 파일이다.</p>
<p><code>Checkpoint</code> 파일을 저장하고 불러옴으로써 학습된 모델을 재사용하고, 지난 학습을 이어서 더 하고 하는 작업들이 가능해진다.</p>
<p>이번 글에서는 <code>Checkpoint</code> 파일을 다루는 tensorflow 모듈에 대해서 알아보고, 능숙하게 딥러닝 모델을 저장하고 불러오는 작업을 수행할 수 있도록 하는 것이 목표이다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><br/>
<br/></p>
<h1 id="0.-&#47784;&#45944;-&#46356;&#47113;&#53552;&#47532;-&#44396;&#51312;">0. &#47784;&#45944; &#46356;&#47113;&#53552;&#47532; &#44396;&#51312;<a class="anchor-link" href="#0.-&#47784;&#45944;-&#46356;&#47113;&#53552;&#47532;-&#44396;&#51312;">&#182;</a></h1><p><hr/>
<br/></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>project(root)<br/>
ㄴmodel<br/>
~ ㄴgraph.py<br/>
~ ㄴrunner.py<br/>
~ ㄴutils.py<br/>
ㄴdata<br/>
~ ㄴtrain_data<br/>
~ ㄴtest_data<br/>
ㄴsaved<br/>
~ <br/></p>
<p>프로젝트 디렉터리 구조가 이렇다고 가정한다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#/model/graph.py</span>

<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>

<span class="k">with</span> <span class="n">g</span><span class="o">.</span><span class="n">as_default</span><span class="p">()</span> <span class="p">:</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;v1&quot;</span><span class="p">)</span>
    <span class="n">v2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;v2&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><br/>
<br/></p>
<h1 id="1.-checkpoint-&#51200;&#51109;">1. checkpoint &#51200;&#51109;<a class="anchor-link" href="#1.-checkpoint-&#51200;&#51109;">&#182;</a></h1><p><hr/>
<br/></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>위의 모델 그래프를 학습시키면서, 학습된 모델의 Variable 들을 checkpoint에 저장해본다.</p>
<p>첫번째 training job 의 이름을 train1 이라고 하자.</p>
<p>train1 job 의 결과물은 <code>/saved/train1.ckpt</code> 에 저장할 것이다.</p>
<p>그러기 위해서는 <code>Checkpoint</code>파일을 저장해주는 tf.train.Saver() 클래스를 이용해야한다.</p>
<p>참고 : <a href="https://www.tensorflow.org/versions/r0.12/api_docs/python/state_ops/saving_and_restoring_variables">tensorflow api 공식 doc : tf.train.Saver</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#/model/train.py</span>

<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">g</span><span class="p">)</span> <span class="k">as</span> <span class="n">sess</span> <span class="p">:</span> 
    
    <span class="c1"># Saver instance 를 생성한다. </span>
    <span class="c1"># Saver.save(sess, ckpt_path) </span>
    <span class="c1"># Saver.restore(sess, ckpt_path)</span>
    
    <span class="n">saver</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">Saver</span><span class="p">()</span>
    
    <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">global_variables_initializer</span><span class="p">())</span>
    
    <span class="c1"># 그래프를 돌리다가 Variable 을 저장하고 싶을 때 Saver.save() 메서드를 사용한다.</span>
    <span class="c1"># args : tf.Session, job`s checkpoint file path</span>
    <span class="c1"># return : job`s checkpoint file path (String)</span>
    
    <span class="n">ckpt_path</span> <span class="o">=</span> <span class="n">saver</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="s2">&quot;saved/train1&quot;</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;job`s ckpt files is save as : &quot;</span><span class="p">,</span> <span class="n">ckpt_path</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>job`s ckpt files is save as :  saved/train1
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>위의 코드를 수행하고 나면 프로젝트의 /saved 디렉터리에 새로운 파일들이 생성된다.</p>
<p>project(root)<br/>
ㄴmodel<br/>
~ ㄴgraph.py<br/>
~ ㄴrunner.py<br/>
~ ㄴutils.py<br/>
ㄴdata<br/>
~ ㄴtrain_data<br/>
~ ㄴtest_data<br/>
ㄴsaved<br/>
~ ㄴ<strong>checkpoint</strong><br/>
~ ㄴ<strong>train1.ckpt.data-00000-of-00001</strong><br/>
~ ㄴ<strong>train1.ckpt.index</strong><br/>
~ ㄴ<strong>train1.ckpt.meta</strong><br/></p>
<p>이들중 job name 인 train1 으로 시작하는 세개의 파일이 train1 job 의 Checkpoint 파일이다.</p>
<p>맨 위의 checkpoint 란 이름의 파일은 조금 이따 이야기한다.
<br/>
<br/><br/>
<br/></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>첫번째 training job : train1 의 결과가 만족스럽지 못해서, 모델을 조금 수정해서 다시 training 을 하려고 한다.</p>
<p>이번 job 의 이름은 train2 라고 하자.</p>
<p>train2 job 의 결과물을 /saved/train2.ckpt 에 저장하는데, 이번엔 매 iteration마다 Variables 의 값을 저장하고싶다.</p>
<p>이럴땐 job의 이름을 유지한채로, iteration 별로 <code>Checkpoint file</code>을 별도로 생성할 수 있다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#/model/train.py(수정함)</span>

<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">g</span><span class="p">)</span> <span class="k">as</span> <span class="n">sess</span> <span class="p">:</span> 
    
    <span class="c1"># 위와 마찬가지로 Saver 생성</span>
    
    <span class="n">saver</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">Saver</span><span class="p">()</span>
    
    <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">global_variables_initializer</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span> 
        
        <span class="c1"># 매 step 마다 모델 저장하고 싶다면 save 메서드에 step 인자를 하나 추가한다.</span>
        <span class="c1"># args : tf.Session, job`s checkpoint file path, step</span>
        <span class="c1"># return : job`s checkpoint file path (String)</span>
        
        <span class="n">ckpt_path</span> <span class="o">=</span> <span class="n">saver</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="s2">&quot;saved/train2&quot;</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span> 
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;save ckpt file:&quot;</span> <span class="p">,</span> <span class="n">ckpt_path</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>save ckpt file: saved/train2-0
save ckpt file: saved/train2-1
save ckpt file: saved/train2-2
save ckpt file: saved/train2-3
save ckpt file: saved/train2-4
save ckpt file: saved/train2-5
save ckpt file: saved/train2-6
save ckpt file: saved/train2-7
save ckpt file: saved/train2-8
save ckpt file: saved/train2-9
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>보다시피 train1 job 과는 다르게 job name 뒤에 iteration의 step 이 적혀져서 총 10묶음의 체크포인트가 만들어진다.</p>
<p>project(root)<br/>
ㄴmodel<br/>
~ ㄴgraph.py<br/>
~ ㄴrunner.py<br/>
~ ㄴutils.py<br/>
ㄴdata<br/>
~ ㄴtrain_data<br/>
~ ㄴtest_data<br/>
ㄴsaved<br/>
~ ㄴ<strong>checkpoint</strong><br/>
~ ㄴtrain1.ckpt.data-00000-of-00001<br/>
~ ㄴtrain1.ckpt.index<br/>
~ ㄴtrain1.ckpt.meta<br/>
~ ㄴ<strong>train2-0.ckpt.data-00000-of-00001</strong><br/>
~ ㄴ<strong>train2-0.ckpt.index</strong><br/>
~ ㄴ<strong>train2-0.ckpt.meta</strong><br/>
~ ㄴ<strong>train2-1.ckpt.data-00000-of-00001</strong><br/>
~ ㄴ<strong>train2-1.ckpt.index</strong><br/>
~ ㄴ<strong>train2-1.ckpt.meta</strong><br/>
~ ㄴ<strong>train2-2.ckpt.data-00000-of-00001</strong><br/>
~ ㄴ<strong>train2-2.ckpt.index</strong><br/>
~ ㄴ<strong>train2-2.ckpt.meta</strong><br/></p>
<p>.
.
.</p>
<p>~ ㄴ<strong>train2-8.ckpt.data-00000-of-00001</strong><br/>
~ ㄴ<strong>train2-8.ckpt.index</strong><br/>
~ ㄴ<strong>train2-8.ckpt.meta</strong><br/>
~ ㄴ<strong>train2-9.ckpt.data-00000-of-00001</strong><br/>
~ ㄴ<strong>train2-9.ckpt.index</strong><br/>
~ ㄴ<strong>train2-9.ckpt.meta</strong><br/></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><br/>
<br/></p>
<h1 id="2.-checkpoint-state-proto">2. checkpoint state proto<a class="anchor-link" href="#2.-checkpoint-state-proto">&#182;</a></h1><p><hr/>
<br/></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/images/tf_ckpt_use/ckptstateproto.png" alt=""></p>
<p>위의 사진은 <a href="https://www.tensorflow.org/versions/r0.12/api_docs/python/state_ops/saving_and_restoring_variables">tensorflow api 공식 doc : tf.train.Saver</a> 사이트에서 볼 수 있는 <strong><em>Checkpoint State Protocol Buffer</em></strong> 에 대한 정보이다.</p>
<p>이름도 거대한 <strong><em>Checkpoint State Protocol Buffer</em></strong> 에 대해서 알 필요가 있다.</p>
<p>Saver 의 save 모듈을 이용해 모델을 저장할 때, Saver 는 <strong><em>Checkpoint State Protocol Buffer</em></strong> 를 /saved/checkpoint 파일에 담아 저장하고, 새로운 job으로 학습할 때 마다 업데이트해 저장한다.</p>
<p><strong><em>Checkpoint State Protocol Buffer</em></strong> 에는 두가지 정보가 담겨있다.</p>
<ol>
<li>model_checkpoint_path : 가장 최근에 저장된 job.ckpt 파일의 path 정보 </li>
<li>all_model_checkpoint_paths : 최근에 저장된 job_i.ckpt 파일들의 path 정보 list</li>
</ol>
<p>보통 saved 폴더에서 가장 최신의 체크포인트파일을 불러와 모델을 재학습시키거나 테스트해보려고 할때 사용한다.</p>
<p>all_model_checkpoint_paths 의 가장 마지막 원소는 model_checkpoint_path 와 동일하다.</p>
<h3 id="Checkpoint-State-Protocol-Buffer-&#51060;&#50857;&#48277;"><strong><em>Checkpoint State Protocol Buffer</em></strong> &#51060;&#50857;&#48277;<a class="anchor-link" href="#Checkpoint-State-Protocol-Buffer-&#51060;&#50857;&#48277;">&#182;</a></h3><p>대표적으로 두가지 방법이 있다.</p>
<ol>
<li>tf.train.get_checkpoint_state(saved_dir_path)</li>
<li>tf.train.latest_checkpoint(saved_dir_path)</li>
</ol>
<h4 id="1.-tf.train.get_checkpoint_state(saved_dir_path)">1. tf.train.get_checkpoint_state(saved_dir_path)<a class="anchor-link" href="#1.-tf.train.get_checkpoint_state(saved_dir_path)">&#182;</a></h4><p><code>saved_dir_path</code> 에서 checkpoint 파일 안의 <strong><em>Checkpoint State Protocol Buffer</em></strong> 를 읽어온다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ckpt_state</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">get_checkpoint_state</span><span class="p">(</span><span class="s2">&quot;saved&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ckpt_state</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;첫번째 정보 사용법:&quot;</span><span class="p">,</span> <span class="n">ckpt_state</span><span class="o">.</span><span class="n">model_checkpoint_path</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;두번째 정보 사용법:&quot;</span><span class="p">,</span> <span class="n">ckpt_state</span><span class="o">.</span><span class="n">all_model_checkpoint_paths</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;tensorflow.python.training.checkpoint_state_pb2.CheckpointState&#39;&gt;
첫번째 정보 사용법: saved/train2-9
두번째 정보 사용법: [&#39;saved/train2-5&#39;, &#39;saved/train2-6&#39;, &#39;saved/train2-7&#39;, &#39;saved/train2-8&#39;, &#39;saved/train2-9&#39;]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="2.-tf.train.latest_checkpoint(saved_dir_path)">2. tf.train.latest_checkpoint(saved_dir_path)<a class="anchor-link" href="#2.-tf.train.latest_checkpoint(saved_dir_path)">&#182;</a></h4><p><code>saved_dir_path</code> 에서 checkpoint 파일 안의 <strong><em>Checkpoint State Protocol Buffer</em></strong> 에서  model_checkpoint_path 정보만 string 으로 반환한다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">recent_ckpt_job_path</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">latest_checkpoint</span><span class="p">(</span><span class="s2">&quot;saved&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">recent_ckpt_job_path</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>saved/train2-9
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><br/>
<br/></p>
<h1 id="3.-checkpoint-&#48520;&#47084;&#50724;&#44592;">3. checkpoint &#48520;&#47084;&#50724;&#44592;<a class="anchor-link" href="#3.-checkpoint-&#48520;&#47084;&#50724;&#44592;">&#182;</a></h1><p><hr/>
<br/></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>저장한 체크포인트 파일들에서 Variable 들을 다시 꺼내서 재사용하려면 tf.Saver 클래스의 restore 메서들을 이용한다.</p>
<p>이때 위에서 언급한 <strong><em>Checkpoint State Protocol Buffer</em></strong> 가 매우 요긴하게 쓰인다.</p>
<p>test1 job 을 수행하는데에 train2 job 에서 마지막에 저장한 변수 ckpt 결과물을 로드해 사용하고싶다.</p>
<p>그렇다면 아래의 코드처럼 하면된다.</p>
<h3 id="case-1:-&#51649;&#51217;-&#48520;&#47084;&#50732;-job.ckpt-&#47749;&#49884;&#54644;&#51452;&#45716;-&#44221;&#50864;">case 1: &#51649;&#51217; &#48520;&#47084;&#50732; job.ckpt &#47749;&#49884;&#54644;&#51452;&#45716; &#44221;&#50864;<a class="anchor-link" href="#case-1:-&#51649;&#51217;-&#48520;&#47084;&#50732;-job.ckpt-&#47749;&#49884;&#54644;&#51452;&#45716;-&#44221;&#50864;">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#/model/test.py</span>

<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">g</span><span class="p">)</span> <span class="k">as</span> <span class="n">sess</span> <span class="p">:</span> 
    
    <span class="c1"># Saver instance 를 생성한다. </span>
    <span class="c1"># Saver.restore(sess, ckpt_path)</span>
    
    <span class="n">saver</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">Saver</span><span class="p">()</span>
    
    <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">global_variables_initializer</span><span class="p">())</span>
    
    <span class="c1"># Saver.restore() </span>
    <span class="c1"># args : tf.Session, job`s checkpoint file path</span>
    <span class="c1"># return : None</span>
    
    <span class="n">ckpt_path</span> <span class="o">=</span> <span class="n">saver</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="s2">&quot;saved/train2-9&quot;</span><span class="p">)</span>
    
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>INFO:tensorflow:Restoring parameters from saved/train2-9
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="case-2:-tf.train.latest_checkpoint(dir_path)-&#51060;&#50857;&#54616;&#45716;-&#44221;&#50864;">case 2: tf.train.latest_checkpoint(dir_path) &#51060;&#50857;&#54616;&#45716; &#44221;&#50864;<a class="anchor-link" href="#case-2:-tf.train.latest_checkpoint(dir_path)-&#51060;&#50857;&#54616;&#45716;-&#44221;&#50864;">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#/model/test.py</span>

<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">g</span><span class="p">)</span> <span class="k">as</span> <span class="n">sess</span> <span class="p">:</span> 
    
    <span class="c1"># Saver instance 를 생성한다. </span>
    <span class="c1"># Saver.restore(sess, ckpt_path)</span>
    
    <span class="n">saver</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">Saver</span><span class="p">()</span>
    
    <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">global_variables_initializer</span><span class="p">())</span>
    
    <span class="c1"># Saver.restore() </span>
    <span class="c1"># args : tf.Session, job`s checkpoint file path</span>
    <span class="c1"># return : None</span>
    
    <span class="n">ckpt_path</span> <span class="o">=</span> <span class="n">saver</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">latest_checkpoint</span><span class="p">(</span><span class="s2">&quot;saved&quot;</span><span class="p">))</span>
    
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>INFO:tensorflow:Restoring parameters from saved/train2-9
</pre>
</div>
</div>

</div>
</div>

</div>
 


  </div>

</div>

<div class="one wide column">

</div>


        <div class="one wide column"></div>

        <div class="fourteen wide column">
          <hr />
          <div id="disqus_thread" class = "ui segment"></div>
          <script>

          /**
          *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
          *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
          /*
          var disqus_config = function () {
          this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
          this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
          };
          */
          (function() { // DON'T EDIT BELOW THIS LINE
          var d = document, s = d.createElement('script');
          s.src = 'https://shinjayne.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
          })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

        </div>

        <div class="one wide column"></div>



        <div class="one wide column">
        </div>
        <div class="fourteen wide column">
          <hr />
          <p>
            powered by <a>Jupyter NoteBook</a> / <a>Jekyll</a> / <a>BootStrap</a> / <a>Semantic-UI</a> / <a>Github Pages</a>
          </p>
          <p>
            source code available on <a href="https://github.com/shinjayne/shinjayne.github.io">here</a>
          </p>
          <p>
            <h2 class=header>shinjayne.github.io</h2>
            <h3 class=header>developer blog</h2>
          </p>

        </div>
        <div class="one wide column">
        </div>



      </div>






    </div>
  </body>
</html>
