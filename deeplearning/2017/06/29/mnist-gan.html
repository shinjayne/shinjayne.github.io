
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Google Analytics js-->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-101872700-1', 'auto');
    ga('send', 'pageview');
  </script>

  <!-- code highlight js / css-->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- BootStrap js / css-->
    <link href="/bootstrap-3.3.2/css/bootstrap.css" rel="stylesheet">
    <!-- jQuery (부트스트랩의 자바스크립트 플러그인을 위해 필요합니다) -->
     <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
     <!-- 모든 컴파일된 플러그인을 포함합니다 (아래), 원하지 않는다면 필요한 각각의 파일을 포함하세요 -->
     <script src="/bootstrap-3.3.2/js/bootstrap.js"></script>

    <!-- JUPYTER NOTEBOOK js / css-->

     <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

     <link href="/jupyterstyle/jupyterstyle.css" rel="stylesheet">


  <!-- Semantic UI js / css-->
    <link rel="stylesheet" type="text/css" href="/semantic/semantic.css">
    <script
      src="https://code.jquery.com/jquery-3.1.1.min.js"
      integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
      crossorigin="anonymous"></script>
    <script src="/semantic/semantic.js"></script>




    <title>tensorflow 로 mnist 흉내내는 GAN 만들기</title>

  </head>
  <body>

    <div class = "ui container">
<!---
      <div class="ui visible left vertical inverted sidebar labeled icon menu">
        <div class="item">
          shinjayne
        </div>
        <h5> <a class="item" href = "http://localhost:4000">Home</a> </h5>
        <h5> <a class="item" href = "http://localhost:4000/category">Categories</a> </h5>
        <h5> <a class="item" href = "http://localhost:4000/about">About</a> </h5>
      </div>
-->
      <div class="ui stackable grid">
        <div class="one wide column">

        </div>

        <div class="fourteen wide column">

            <div class="ui center aligned inverted segment" >

              <h1  class="ui inverted header" ></h1>
              <h1  class="ui inverted header" >shinjayne</h1>
              <h1  class="ui inverted header" ></h1>

              <div class="right item">
                <a class="ui inverted button" href = "http://localhost:4000">Home</a>
                <a class="ui inverted button" href = "http://localhost:4000/category">Categories</a>
                <a class="ui inverted button" href = "http://localhost:4000/projects">Projects</a>
              </div>
            </div>
        </div>

        <div class="one wide column">

        </div>

        <div class="one wide column">

</div>

<div class="fourteen wide column">
  <div class = "ui segment">
    <h1>tensorflow 로 mnist 흉내내는 GAN 만들기</h1>

    <li>
      작성일 : 29 June 2017
    </li>
    <li>
      카테고리 : <a href = "http://localhost:4000/category">DeepLearning</a>
    </li>
  </div>

  <div class = "ui segment">
    
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>잠깐!</p>
<h4 id="pre-requisite-knowledge">pre-requisite knowledge<a class="anchor-link" href="#pre-requisite-knowledge">&#182;</a></h4><p><hr/>
아래의 지식들을 알고 계셔야 읽기 편한 글입니다.</p>
<blockquote><ol>
<li><p>tensorflow, numpy, matplotlib 사용법</p>
</li>
<li><p>Nueral Network (특히 Binary Classification)</p>
</li>
<li><p>epoch, batch 단위 학습 방식</p>
</li>
</ol>
</blockquote>
<p><br/>
<br/>
<br/>
<br/></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>이번 글에서는 <strong>GAN (Generative Adversarial Networks)</strong> 를 tensorflow code 로 구현하는 방법을 알아보려고 합니다.</p>
<p>간단한 GAN 알고리즘을 통해서, MNIST 숫자 손글씨 데이터와 닮은 가짜 손글씨 데이터를 만들어내는 모델(<code>mnist_GAN</code>)을 만들어 보겠습니다.</p>
<p>결과물을 미리 살짝 엿보자면 아래와 같은 실제 MNIST 데이터를</p>
<p><img src="/images/mnist_digits.png" alt="real_mnist"></p>
<p>모델에게 계속 보여주면서 훈련시키면</p>
<p>나중에는 아래처럼 비스무리한 숫자를 스스로 만들어낼 수 있습니다.</p>
<p><img src="/images/goblin-gan-generated/099.png" alt="title"></p>
<p>이는 실제 제가 얻은 결과입니다.</p>
<p>이번 공부를 하면서 참고한 자료는 아래 링크의 코드입니다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://github.com/golbin/TensorFlow-Tutorials/blob/master/07%20-%20GAN/01%20-%20GAN.py">https://github.com/golbin/TensorFlow-Tutorials/blob/master/07%20-%20GAN/01%20-%20GAN.py</a></p>
<p><br/>
<br/>
그럼 이제</p>
<p>어떻게 mnist 손글씨와 비슷한 이미지를 생성하는 mnist_GAN 모델을 구현하는지 보도록 하겠습니다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><br/>
<br/></p>
<h1 id="01--mnist_GAN-&#51032;-&#44396;&#51312;&#50752;-&#45936;&#51060;&#53552;&#51032;-&#55120;&#47492;">01  mnist_GAN &#51032; &#44396;&#51312;&#50752; &#45936;&#51060;&#53552;&#51032; &#55120;&#47492;<a class="anchor-link" href="#01--mnist_GAN-&#51032;-&#44396;&#51312;&#50752;-&#45936;&#51060;&#53552;&#51032;-&#55120;&#47492;">&#182;</a></h1><hr/>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>만들어볼 모델의 구조를 설명드리겠습니다.</p>
<p><img src="/images/goblin_gan.png" alt="title"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>GAN 은 두개의 서로 다른 학습 가능한 모델이 서로 경쟁하면서 학습합니다.</p>
<p>두 모델의 이름은 각각 <strong><em>Genarator(생성기) , Discriminator (분류기) </em></strong>입니다 .</p>
<h3 id="Discriminator-(&#48516;&#47448;&#44592;)">Discriminator (&#48516;&#47448;&#44592;)<a class="anchor-link" href="#Discriminator-(&#48516;&#47448;&#44592;)">&#182;</a></h3><p>분류기는 단순한 classification 을 수행하는 모델입니다.</p>
<p>이미지 데이터를 input 으로 받으면 그 이미지가 실제 이미지(real)인지 가짜 이미지(fake) 인지 분류합니다.</p>
<p>실제 이미지일 확률이 높으면 1에 가까운 수를,</p>
<p>가짜 이미지일 확률이 높으면 0에 가까운 수를 반환합니다.</p>
<blockquote><p><strong>분류기의 성능(성취도)</strong>는 실제 이미지를 잘 구분할수록, 즉 실제 이미지에 1에 가까운 수를 부여할수록 좋다고 할 수 있습니다.</p>
</blockquote>
<p>분류기는 간단한 binary classification 기능을 할 수 있는 2 layer NN 구조를 사용했습니다.</p>
<h3 id="Genarator-(&#49373;&#49457;&#44592;)">Genarator (&#49373;&#49457;&#44592;)<a class="anchor-link" href="#Genarator-(&#49373;&#49457;&#44592;)">&#182;</a></h3><p>생성기는 가짜 이미지를 만들어냅니다.</p>
<p>noise 데이터 [128] 을 input 으로 받으면, 그 noise 를 바탕으로</p>
<p>output 으로 만들어낸 이미지 데이터[784] 를 생성합니다.</p>
<blockquote><p><strong>생성기의 성능(성취도)</strong>는 자신이 만든 가짜 이미지를 분류기에 보여주었을 때 1에 가까운 수를 부여할 수록 좋다고 할 수 있습니다.</p>
</blockquote>
<p>생성기 내부를 구현하는 방법에는 다양한 방법이 있을 수 있지만,</p>
<p>저는 단순히 2 layer NN 의 구조를 사용해보았습니다.</p>
<h3 id="placeholder-Z">placeholder Z<a class="anchor-link" href="#placeholder-Z">&#182;</a></h3><p>Z 는 우리가 random 한 noise 를 넣어줄 placeholder 입니다.</p>
<p>미세하게 어떤 noise 가 들어갔는지에 따라서 생성기가 만들어내는 가짜이미지가 달라질 것입니다.</p>
<p>noise 의 크기는 임의로 128로 지정해놓았습니다.</p>
<h3 id="placeholder-X">placeholder X<a class="anchor-link" href="#placeholder-X">&#182;</a></h3><p>X 는 분류기에게 보여줄 실제 이미지입니다.</p>
<p>mnist 에서 제공하는 손글씨 숫자데이터 55000개를 이용할 것입니다.</p>
<p>[55000, 784]</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><br/>
<br/></p>
<h1 id="02-&#54617;&#49845;-&#48169;&#48277;-(loss-function,-train)">02 &#54617;&#49845; &#48169;&#48277; (loss function, train)<a class="anchor-link" href="#02-&#54617;&#49845;-&#48169;&#48277;-(loss-function,-train)">&#182;</a></h1><p><hr/>
그렇다면 두개의 모델(분류기와 생성기)를 어떻게 학습시켜야할까요?</p>
<p>학습을 위해서는 적절한 loss function 이 필요합니다.</p>
<p>GAN 에는 loss function 이 손실을 나타낸다기보다 , 각 모델의 성취도 혹은 성능을 나타낸다고 하는 것이 좋을 것 같습니다.</p>
<p>각 모델의 <strong>loss function(성능) 을 최대화</strong> 하는 것이 학습의 목표이기 때문입니다.</p>
<p>위의 모델 설명에서 언급한 내용을 잠시 다시 보겠습니다.</p>
<blockquote><p><strong>분류기의 성능(성취도)</strong>는 실제 이미지를 잘 구분할수록, 즉 실제 이미지에 1에 가까운 수를 부여할수록 좋다고 할 수 있습니다.</p>
<p><strong>생성기의 성능(성취도)</strong>는 자신이 만든 가짜 이미지를 분류기에 보여주었을 때 1에 가까운 수를 부여할 수록 좋다고 할 수 있습니다.</p>
</blockquote>
<p>이 두 성취도는 위 모델 그림의 fake-result 와 real-result 로 다시 나타낼 수 있습니다.</p>
<blockquote><p><strong>분류기의 성능(성취도)</strong> <code>d_loss</code>  는 real-result 는 높을수록, fake-result 는 낮을수록 좋습니다.</p>
<p><strong>생성기의 성능(성취도)</strong> <code>g_loss</code>  는 fake-result 가 높을수록 좋습니다.</p>
</blockquote>
<p>이 d_loss 와 g_loss 를 각각 학습시켜, 최대화하도록 하면</p>
<p>생성기의 성능과 분류기의 성능이 서로 경쟁적으로 올라가게 됩니다.</p>
<p><br/>
<br/></p>
<h1 id="03-&#54617;&#49845;&#51012;-&#47560;&#52828;-&#54980;&#50640;&#45716;-...">03 &#54617;&#49845;&#51012; &#47560;&#52828; &#54980;&#50640;&#45716; ...<a class="anchor-link" href="#03-&#54617;&#49845;&#51012;-&#47560;&#52828;-&#54980;&#50640;&#45716;-...">&#182;</a></h1><hr/>

<p>생성기에 새로운 noise 를 넣어서 실제 손글씨와 비슷한 이미지를 만들어내는지 확인해볼 것입니다.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><br/>
<br/></p>
<h1 id="04-Tensorflow-Code-&#47196;-&#51649;&#51217;-&#51676;&#48372;&#44592;">04 Tensorflow Code &#47196; &#51649;&#51217; &#51676;&#48372;&#44592;<a class="anchor-link" href="#04-Tensorflow-Code-&#47196;-&#51649;&#51217;-&#51676;&#48372;&#44592;">&#182;</a></h1><hr/>

<p>이제 개념 정리와 어떻게 모델을 구성하고 학습할지에 대한 계획이 끝났으니,</p>
<p>실제 tensorflow 로 코드를 짜보도록 하겠습니다.</p>
<p><hr/>
(1) Import Packages</p>
<p>(2) 사용할 데이터 load</p>
<p>(3) Hyper-Parameters 설정</p>
<p>(4) 필요한 module 만들기</p>
<p>(5) Graph 짜기</p>
<p>(6) Graph Run 해서 반복 training 으로 variable update</p>
<hr/>

<p><br/>
<br/>
<br/>
<br/><br/></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="(1)-Import-Packages">(1) Import Packages<a class="anchor-link" href="#(1)-Import-Packages">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="(2)-&#49324;&#50857;&#54624;-&#45936;&#51060;&#53552;-load">(2) &#49324;&#50857;&#54624; &#45936;&#51060;&#53552; load<a class="anchor-link" href="#(2)-&#49324;&#50857;&#54624;-&#45936;&#51060;&#53552;-load">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">tensorflow.examples.tutorials.mnist</span> <span class="k">import</span> <span class="n">input_data</span>
<span class="n">mnist</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">read_data_sets</span><span class="p">(</span><span class="s2">&quot;MNIST_data/&quot;</span><span class="p">)</span> 
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>Extracting MNIST_data/train-images-idx3-ubyte.gz
Extracting MNIST_data/train-labels-idx1-ubyte.gz
Extracting MNIST_data/t10k-images-idx3-ubyte.gz
Extracting MNIST_data/t10k-labels-idx1-ubyte.gz
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_x</span> <span class="o">=</span> <span class="n">mnist</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">images</span>
<span class="n">train_y</span> <span class="o">=</span> <span class="n">mnist</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">labels</span>

<span class="nb">print</span><span class="p">(</span><span class="n">train_x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">train_y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>(55000, 784) (55000,)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="(3)-Hyper-Parameters-&#49444;&#51221;">(3) Hyper-Parameters &#49444;&#51221;<a class="anchor-link" href="#(3)-Hyper-Parameters-&#49444;&#51221;">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">total_epochs</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">0.0002</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="(4)-&#54596;&#50836;&#54620;-module-&#47564;&#46308;&#44592;">(4) &#54596;&#50836;&#54620; module &#47564;&#46308;&#44592;<a class="anchor-link" href="#(4)-&#54596;&#50836;&#54620;-module-&#47564;&#46308;&#44592;">&#182;</a></h3><table>
<thead><tr>
<th style="text-align:left">모듈이름</th>
<th style="text-align:left">기능</th>
<th style="text-align:left">input</th>
<th style="text-align:left">output</th>
<th style="text-align:left">trainable_variables</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">generator</td>
<td style="text-align:left">2 layer NN 로 구성된 가짜이미지 생성기를 호출합니다.</td>
<td style="text-align:left">noise z [-, 128]</td>
<td style="text-align:left">fake images [-,784]</td>
<td style="text-align:left">Gen/w1, Gen/b1, Gen/w2, Gen/gb2</td>
</tr>
<tr>
<td style="text-align:left">discriminator</td>
<td style="text-align:left">2 layer NN 로 구성된 binary 분류기를 호출합니다.</td>
<td style="text-align:left">real/fake images x [-,784]</td>
<td style="text-align:left">scores [-,1]</td>
<td style="text-align:left">Dis/w1, Dis/b1, Dis/w2, Dis/b2</td>
</tr>
<tr>
<td style="text-align:left">random_noise</td>
<td style="text-align:left">호출할 때마다 random normal한 batch_size 갯수의 noise 를 생성합니다.</td>
<td style="text-align:left">batch_size</td>
<td style="text-align:left">noise [batch_size, 128]</td>
<td style="text-align:left">-</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="&lt;-module1-:-Generator-(-&#49373;&#49457;&#44592;-)-&gt;">&lt; module1 : Generator ( &#49373;&#49457;&#44592; ) &gt;<a class="anchor-link" href="#&lt;-module1-:-Generator-(-&#49373;&#49457;&#44592;-)-&gt;">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">generator</span><span class="p">(</span> <span class="n">z</span> <span class="p">,</span> <span class="n">reuse</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">)</span> <span class="p">:</span> 
    <span class="k">if</span> <span class="n">reuse</span><span class="o">==</span><span class="kc">False</span> <span class="p">:</span> 
        <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">variable_scope</span><span class="p">(</span><span class="n">name_or_scope</span> <span class="o">=</span> <span class="s2">&quot;Gen&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">scope</span> <span class="p">:</span> 
            <span class="n">gw1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;w1&quot;</span><span class="p">,</span> 
                                  <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">],</span> 
                                  <span class="n">initializer</span><span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random_normal_initializer</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">stddev</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">))</span> 
            <span class="c1"># quiz : weight 의 초깃값을 random normal 로 주는 이유는 무엇일까요?</span>
            
            <span class="n">gb1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;b1&quot;</span><span class="p">,</span>
                                 <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">256</span><span class="p">],</span>
                                 <span class="n">initializer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random_normal_initializer</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">stddev</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">))</span> 
            
            <span class="n">gw2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;w2&quot;</span><span class="p">,</span> 
                                  <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">784</span><span class="p">],</span> 
                                  <span class="n">initializer</span><span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random_normal_initializer</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">stddev</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">))</span> 
            
            <span class="n">gb2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;b2&quot;</span><span class="p">,</span>
                                 <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">784</span><span class="p">],</span>
                                 <span class="n">initializer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random_normal_initializer</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">stddev</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">))</span> 
    <span class="k">else</span> <span class="p">:</span> 
        <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">variable_scope</span><span class="p">(</span><span class="n">name_or_scope</span><span class="o">=</span><span class="s2">&quot;Gen&quot;</span><span class="p">,</span> <span class="n">reuse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">scope</span> <span class="p">:</span> 
            <span class="n">gw1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;w1&quot;</span><span class="p">,</span> 
                                  <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">],</span> 
                                  <span class="n">initializer</span><span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random_normal_initializer</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">stddev</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">))</span> 
            
            <span class="n">gb1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;b1&quot;</span><span class="p">,</span>
                                 <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">256</span><span class="p">],</span>
                                 <span class="n">initializer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random_normal_initializer</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">stddev</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">))</span> 
            
            <span class="n">gw2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;w2&quot;</span><span class="p">,</span> 
                                  <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">784</span><span class="p">],</span> 
                                  <span class="n">initializer</span><span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random_normal_initializer</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">stddev</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">))</span> 
            
            <span class="n">gb2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;b2&quot;</span><span class="p">,</span>
                                 <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">784</span><span class="p">],</span>
                                 <span class="n">initializer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random_normal_initializer</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">stddev</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">))</span> 
        
        
    <span class="n">hidden</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span> <span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">z</span> <span class="p">,</span> <span class="n">gw1</span><span class="p">)</span> <span class="o">+</span> <span class="n">gb1</span> <span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span> <span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">hidden</span><span class="p">,</span> <span class="n">gw2</span><span class="p">)</span> <span class="o">+</span> <span class="n">gb2</span> <span class="p">)</span>   <span class="c1">#출력층에 시그모이드를 쓰는 이유는 무엇일까요? </span>
    
    <span class="k">return</span> <span class="n">output</span>   <span class="c1">#[784] 가짜 생성된 이미지 </span>
    
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="&lt;-module2-:-Discriminator-(-&#48516;&#47448;&#44592;-)-&gt;">&lt; module2 : Discriminator ( &#48516;&#47448;&#44592; ) &gt;<a class="anchor-link" href="#&lt;-module2-:-Discriminator-(-&#48516;&#47448;&#44592;-)-&gt;">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">discriminator</span><span class="p">(</span> <span class="n">x</span> <span class="p">,</span> <span class="n">reuse</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="p">:</span> 

    <span class="k">if</span><span class="p">(</span><span class="n">reuse</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span> <span class="p">:</span> 
        <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">variable_scope</span><span class="p">(</span><span class="n">name_or_scope</span><span class="o">=</span><span class="s2">&quot;Dis&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">scope</span> <span class="p">:</span> 
            <span class="n">dw1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;w1&quot;</span><span class="p">,</span> 
                                  <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">784</span><span class="p">,</span> <span class="mi">256</span><span class="p">],</span> 
                                  <span class="n">initializer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random_normal_initializer</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">db1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;b1&quot;</span><span class="p">,</span> 
                                  <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">256</span><span class="p">],</span> 
                                  <span class="n">initializer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random_normal_initializer</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">dw2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;w2&quot;</span><span class="p">,</span> 
                                  <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> 
                                  <span class="n">initializer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random_normal_initializer</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">db2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;b2&quot;</span><span class="p">,</span> 
                                  <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                                  <span class="n">initializer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random_normal_initializer</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">else</span> <span class="p">:</span> 
        <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">variable_scope</span><span class="p">(</span><span class="n">name_or_scope</span><span class="o">=</span><span class="s2">&quot;Dis&quot;</span><span class="p">,</span> <span class="n">reuse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">scope</span> <span class="p">:</span> 
            <span class="n">dw1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;w1&quot;</span><span class="p">,</span> 
                                  <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">784</span><span class="p">,</span> <span class="mi">256</span><span class="p">],</span> 
                                  <span class="n">initializer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random_normal_initializer</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">db1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;b1&quot;</span><span class="p">,</span> 
                                  <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">256</span><span class="p">],</span> 
                                  <span class="n">initializer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random_normal_initializer</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">dw2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;w2&quot;</span><span class="p">,</span> 
                                  <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> 
                                  <span class="n">initializer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random_normal_initializer</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">db2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;b2&quot;</span><span class="p">,</span> 
                                  <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                                  <span class="n">initializer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">random_normal_initializer</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span> <span class="p">)</span>
            
    <span class="n">hidden</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span> <span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">x</span> <span class="p">,</span> <span class="n">dw1</span><span class="p">)</span> <span class="o">+</span> <span class="n">db1</span> <span class="p">)</span>  <span class="c1">#[-, 256]</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span> <span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">hidden</span><span class="p">,</span> <span class="n">dw2</span><span class="p">)</span>  <span class="o">+</span> <span class="n">db2</span> <span class="p">)</span>   <span class="c1">#[-, 1]  진품인지(1) 가품인지(0)의 label 결과값</span>
    
    <span class="k">return</span> <span class="n">output</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="&lt;-module3-:--random-noise-&#49373;&#49457;&#44592;-&gt;">&lt; module3 :  random noise &#49373;&#49457;&#44592; &gt;<a class="anchor-link" href="#&lt;-module3-:--random-noise-&#49373;&#49457;&#44592;-&gt;">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">random_noise</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span> <span class="p">:</span> 
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="n">batch_size</span> <span class="p">,</span> <span class="mi">128</span><span class="p">])</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="(5)-Graph-&#51676;&#44592;">(5) Graph &#51676;&#44592;<a class="anchor-link" href="#(5)-Graph-&#51676;&#44592;">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>

<span class="k">with</span> <span class="n">g</span><span class="o">.</span><span class="n">as_default</span><span class="p">()</span> <span class="p">:</span> 
    
    <span class="c1">######################################################</span>
    <span class="c1"># 1 .Feedable part  :: 그래프에서 유일하게 데이터가 유입될 수 있는 장소 </span>
    <span class="c1">######################################################</span>
    
    <span class="n">X</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">784</span><span class="p">])</span> <span class="c1">#GAN 은 autoencoder 와 마찬가지로 unsupervised learning 이므로 y(label)을 사용하지 않습니다.</span>
 
    <span class="n">Z</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">128</span><span class="p">])</span> <span class="c1">#Z 는 생성기의 입력값으로 사용될 노이즈 입니다. </span>
    
    
    <span class="c1">################################</span>
    <span class="c1"># 2. generator 와 discriminator 의 사용 </span>
    <span class="c1">##################################</span>

    
    <span class="n">fake_x</span> <span class="o">=</span> <span class="n">generator</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
    
    <span class="n">result_of_fake</span> <span class="o">=</span> <span class="n">discriminator</span><span class="p">(</span><span class="n">fake_x</span><span class="p">)</span>
    <span class="n">result_of_real</span> <span class="o">=</span> <span class="n">discriminator</span><span class="p">(</span><span class="n">X</span> <span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    
    
    <span class="c1">################################</span>
    <span class="c1"># 3. Loss( 성취도평가 ) : g_loss 와 d_loss</span>
    
    <span class="c1"># g_loss &amp; d_loss 모두 높을 수록 좋다.</span>
    <span class="c1"># g_loss : 얼마나 fake_x 가 진짜같은가</span>
    <span class="c1"># d_loss : 얼마나 discriminator 가 정확한가 </span>
    
    <span class="c1"># 두 수치를 모두 높이도록 train 하면 생성기와 분류기의 성능이 모두 올라간다. </span>
    <span class="c1">################################</span>
    
    <span class="n">g_loss</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span> <span class="n">tf</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">result_of_fake</span><span class="p">)</span> <span class="p">)</span> 
    <span class="n">d_loss</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span> <span class="n">tf</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">result_of_real</span><span class="p">)</span> <span class="o">+</span> <span class="n">tf</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">result_of_fake</span><span class="p">)</span> <span class="p">)</span>
    
    
    <span class="c1">################################</span>
    <span class="c1"># 4. Train : Maximizing g_loss &amp; d_loss</span>
    <span class="c1">################################</span>
    
    <span class="n">t_vars</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">trainable_variables</span><span class="p">()</span> <span class="c1"># return list </span>
    
    <span class="n">g_vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">t_vars</span> <span class="k">if</span> <span class="s2">&quot;Gen&quot;</span> <span class="ow">in</span> <span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
    <span class="n">d_vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">t_vars</span> <span class="k">if</span> <span class="s2">&quot;Dis&quot;</span> <span class="ow">in</span> <span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
    
    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">AdamOptimizer</span><span class="p">(</span><span class="n">learning_rate</span><span class="p">)</span>
    
    <span class="n">g_train</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="o">-</span><span class="n">g_loss</span><span class="p">,</span> <span class="n">var_list</span><span class="o">=</span> <span class="n">g_vars</span><span class="p">)</span>
    <span class="n">d_train</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="o">-</span><span class="n">d_loss</span><span class="p">,</span> <span class="n">var_list</span> <span class="o">=</span> <span class="n">d_vars</span><span class="p">)</span>    
    
    <span class="c1"># g_loss &amp; d_loss 를 최대화 시켜야하는데 minimize 함수밖에 없기 때문에 - 음수부호 붙인다.</span>
    
    
    
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="(6)-Graph-Run-&#54644;&#49436;-&#48152;&#48373;-training-&#51004;&#47196;-variable-update">(6) Graph Run &#54644;&#49436; &#48152;&#48373; training &#51004;&#47196; variable update<a class="anchor-link" href="#(6)-Graph-Run-&#54644;&#49436;-&#48152;&#48373;-training-&#51004;&#47196;-variable-update">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">graph</span> <span class="o">=</span> <span class="n">g</span><span class="p">)</span> <span class="k">as</span> <span class="n">sess</span> <span class="p">:</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">global_variables_initializer</span><span class="p">())</span>
    
    <span class="n">total_batchs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">train_x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">batch_size</span><span class="p">)</span> 
    
    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">total_epochs</span><span class="p">)</span> <span class="p">:</span> 
        
        <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">total_batchs</span><span class="p">)</span> <span class="p">:</span> 
            <span class="n">batch_x</span> <span class="o">=</span> <span class="n">train_x</span><span class="p">[</span><span class="n">batch</span> <span class="o">*</span> <span class="n">batch_size</span> <span class="p">:</span> <span class="p">(</span><span class="n">batch</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">batch_size</span><span class="p">]</span>  <span class="c1"># [batch_size , 784]</span>
            <span class="n">batch_y</span> <span class="o">=</span> <span class="n">train_y</span><span class="p">[</span><span class="n">batch</span> <span class="o">*</span> <span class="n">batch_size</span> <span class="p">:</span> <span class="p">(</span><span class="n">batch</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">batch_size</span><span class="p">]</span>  <span class="c1"># [batch_size,]</span>
            <span class="n">noise</span> <span class="o">=</span> <span class="n">random_noise</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span>  <span class="c1"># [batch_size, 128] </span>
            
            <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">g_train</span> <span class="p">,</span> <span class="n">feed_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">Z</span> <span class="p">:</span> <span class="n">noise</span><span class="p">})</span>
            <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">d_train</span><span class="p">,</span> <span class="n">feed_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">X</span> <span class="p">:</span> <span class="n">batch_x</span> <span class="p">,</span> <span class="n">Z</span> <span class="p">:</span> <span class="n">noise</span><span class="p">})</span>
            
            <span class="n">gl</span><span class="p">,</span> <span class="n">dl</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">g_loss</span><span class="p">,</span> <span class="n">d_loss</span><span class="p">],</span> <span class="n">feed_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">X</span> <span class="p">:</span> <span class="n">batch_x</span> <span class="p">,</span> <span class="n">Z</span> <span class="p">:</span> <span class="n">noise</span><span class="p">})</span>
    
    
        <span class="c1">#매 20 epoch 마다 학습된 성능을 중간점검  (실제론 더 자주하시는 것이 좋습니다. )</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">20</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">epoch</span> <span class="o">==</span> <span class="mi">1</span>  <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=======Epoch : &quot;</span><span class="p">,</span> <span class="n">epoch</span> <span class="p">,</span> <span class="s2">&quot; =======================================&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;생성기 성능 : &quot;</span> <span class="p">,</span><span class="n">gl</span> <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;분류기 성능 : &quot;</span> <span class="p">,</span><span class="n">dl</span> <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;생성기와 분류기 선의의 경쟁중...&quot;</span><span class="p">)</span>
            
        
        <span class="c1">#10개의 epoch 마다 Generator 가 만들어내는 실제 결과물을 얻어보며 , 성능 발전을 시각적으로 확인</span>
    
        <span class="k">if</span> <span class="n">epoch</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="n">epoch</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span>  <span class="p">:</span> 
            <span class="n">sample_noise</span> <span class="o">=</span> <span class="n">random_noise</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            
            <span class="n">generated</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fake_x</span> <span class="p">,</span> <span class="n">feed_dict</span> <span class="o">=</span> <span class="p">{</span> <span class="n">Z</span> <span class="p">:</span> <span class="n">sample_noise</span><span class="p">})</span>
            
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="p">:</span> 
                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span> <span class="n">generated</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">))</span> <span class="p">)</span>
            
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;goblin-gan-generated/</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">epoch</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        
        
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;최적화 완료!&#39;</span><span class="p">)</span>
        
        
    
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>=======Epoch :  1  =======================================
생성기 성능 :  -3.06128
분류기 성능 :  -0.200115
생성기와 분류기 선의의 경쟁중...
=======Epoch :  19  =======================================
생성기 성능 :  -2.32224
분류기 성능 :  -0.4686
생성기와 분류기 선의의 경쟁중...
=======Epoch :  39  =======================================
생성기 성능 :  -1.91436
분류기 성능 :  -0.619524
생성기와 분류기 선의의 경쟁중...
=======Epoch :  59  =======================================
생성기 성능 :  -1.69127
분류기 성능 :  -0.593143
생성기와 분류기 선의의 경쟁중...
=======Epoch :  79  =======================================
생성기 성능 :  -1.62559
분류기 성능 :  -0.574774
생성기와 분류기 선의의 경쟁중...
=======Epoch :  99  =======================================
생성기 성능 :  -1.76843
분류기 성능 :  -0.501177
생성기와 분류기 선의의 경쟁중...
최적화 완료!
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><br/>
<br/></p>
<h1 id="05-&#44208;&#44284;&#47932;-&#48372;&#44592;">05 &#44208;&#44284;&#47932; &#48372;&#44592;<a class="anchor-link" href="#05-&#44208;&#44284;&#47932;-&#48372;&#44592;">&#182;</a></h1><p><hr/>
위의 코드에서 , 매 10 epoch 마다 generator(생성기) 에 임의의 noise 10개를 주어서 생성되는 10개의 이미지를 저장했습니다.</p>
<p>이 결과를 보면 , 학습이 진행되면 진행될수록 생성기가 실제 사람 손글씨와 비슷한 이미지 형태를 생성해냄을 볼 수 있습니다.</p>
<h3 id="epoch-0">epoch 0<a class="anchor-link" href="#epoch-0">&#182;</a></h3><p><img src="/images/goblin-gan-generated/000.png" alt="000"></p>
<h3 id="epoch-9">epoch 9<a class="anchor-link" href="#epoch-9">&#182;</a></h3><p><img src="/images/goblin-gan-generated/009.png" alt="title"></p>
<h3 id="epoch-19">epoch 19<a class="anchor-link" href="#epoch-19">&#182;</a></h3><p><img src="/images/goblin-gan-generated/019.png" alt="title"></p>
<h3 id="epoch-29">epoch 29<a class="anchor-link" href="#epoch-29">&#182;</a></h3><p><img src="/images/goblin-gan-generated/029.png" alt="title"></p>
<h3 id="epoch-39">epoch 39<a class="anchor-link" href="#epoch-39">&#182;</a></h3><p><img src="/images/goblin-gan-generated/039.png" alt="title"></p>
<h3 id="epoch-49">epoch 49<a class="anchor-link" href="#epoch-49">&#182;</a></h3><p><img src="/images/goblin-gan-generated/049.png" alt="title"></p>
<h3 id="epoch-59">epoch 59<a class="anchor-link" href="#epoch-59">&#182;</a></h3><p><img src="/images/goblin-gan-generated/059.png" alt="title"></p>
<h3 id="epoch-69">epoch 69<a class="anchor-link" href="#epoch-69">&#182;</a></h3><p><img src="/images/goblin-gan-generated/069.png" alt="title"></p>
<h3 id="epoch-79">epoch 79<a class="anchor-link" href="#epoch-79">&#182;</a></h3><p><img src="/images/goblin-gan-generated/079.png" alt="title"></p>
<h3 id="epoch-89">epoch 89<a class="anchor-link" href="#epoch-89">&#182;</a></h3><p><img src="/images/goblin-gan-generated/089.png" alt="title"></p>
<h3 id="epoch-99">epoch 99<a class="anchor-link" href="#epoch-99">&#182;</a></h3><p><img src="/images/goblin-gan-generated/099.png" alt="title"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><br/>
<br/></p>
<h1 id="&#47560;&#52824;&#47728;-...">&#47560;&#52824;&#47728; ...<a class="anchor-link" href="#&#47560;&#52824;&#47728;-...">&#182;</a></h1><hr/>

<p>간단한 2 layer NN 와 mnist data, 그리고 GAN 구조를 이용해 mnist 손글씨를 흉내내는 모델을 tensorflow 만들어보았습니다.</p>
<p>코드를 보시다 궁금한 점이나 오류가 있다면</p>
<p>아래 댓글로 남겨주시면 감사하겠습니다 ^^ .</p>

</div>
</div>
</div>
 


  </div>

</div>

<div class="one wide column">

</div>


        <div class="one wide column"></div>

        <div class="fourteen wide column">
          <hr />
          <div id="disqus_thread" class = "ui segment"></div>
          <script>

          /**
          *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
          *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
          /*
          var disqus_config = function () {
          this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
          this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
          };
          */
          (function() { // DON'T EDIT BELOW THIS LINE
          var d = document, s = d.createElement('script');
          s.src = 'https://shinjayne.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
          })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

        </div>

        <div class="one wide column"></div>



        <div class="one wide column">
        </div>
        <div class="fourteen wide column">
          <hr />
          <p>
            powered by <a>Jupyter NoteBook</a> / <a>Jekyll</a> / <a>BootStrap</a> / <a>Semantic-UI</a> / <a>Github Pages</a>
          </p>
          <p>
            source code available on <a href="https://github.com/shinjayne/shinjayne.github.io">here</a>
          </p>
          <p>
            <h2 class=header>shinjayne.github.io</h2>
            <h3 class=header>developer blog</h2>
          </p>

        </div>
        <div class="one wide column">
        </div>



      </div>






    </div>
  </body>
</html>
